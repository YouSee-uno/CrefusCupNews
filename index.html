<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrefusCup 順位速報</title>
    <link href="https://fonts.googleapis.com/css2?family=BIZ+UDGothic:wght@400;700&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        :root {
            /* 背景を完全に不透明な白に設定 */
            --table-bg: #ffffff;
            --header-bg: #f2f2f2;
            --border-color: #dddddd;
        }

        body {
            background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);
            font-family: 'BIZ UDGothic', sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: #000000; /* 文字を完全な黒に */
            padding: 20px 10px;
            box-sizing: border-box;
        }

        h1 {
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            font-size: clamp(1.2rem, 5vw, 1.8rem);
        }

        /* タブコンテナ */
        .tab-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            max-width: 900px;
            margin-bottom: 20px;
        }

        .tab-button {
            background: rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .tab-button.active {
            background: white;
            color: #458a25;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* --- テーブル全体のコンテナ --- */
        .scroll-container {
            width: 100%;
            max-width: 800px;
            height: 70vh;
            overflow-y: auto;
            background: var(--table-bg); /* 完全な白 */
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            text-align: center;
        }

        /* タイトル部分（ヘッダー）の固定 */
        thead th {
            position: sticky;
            top: 0;
            z-index: 20;
            background: var(--header-bg);
            color: #000000;
            padding: 18px 10px;
            font-weight: bold;
            border-bottom: 2px solid #bbb;
        }

        /* データ部分 */
        tbody td {
            padding: 15px 10px;
            border-bottom: 1px solid var(--border-color);
            font-size: 1.1rem;
            color: #000000;
            background-color: #ffffff; /* 行の背景も白に固定 */
        }

        /* 1位〜3位の強調（不透明な色で設定） */
        tr:nth-child(1) td { background-color: #fff4b0 !important; font-weight: bold; } /* ゴールド */
        tr:nth-child(2) td { background-color: #f0f0f0 !important; } /* シルバー */
        tr:nth-child(3) td { background-color: #f9e8d9 !important; } /* ブロンズ */

        /* ロード中メッセージ */
        .loading {
            padding: 40px;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>CrefusCup 順位速報</h1>
    
    <div class="tab-container">
        <button class="tab-button active" onclick="switchTab('bronze', this)">ブロンズ</button>
        <button class="tab-button" onclick="switchTab('silver', this)">シルバー</button>
        <button class="tab-button" onclick="switchTab('gold', this)">ゴールド</button>
        <button class="tab-button" onclick="switchTab('platinum', this)">プラチナ</button>
        <button class="tab-button" onclick="switchTab('m2spike', this)">M2 SPIKE</button>
        <button class="tab-button" onclick="switchTab('m2ev3', this)">M2 EV3</button>
        <button class="tab-button" onclick="switchTab('m3', this)">M3</button>
    </div>
    
    <div class="scroll-container">
        <table id="result_table">
            <thead>
                <tr>
                    <th>順位</th>
                    <th>選手番号</th>
                    <th>最高点(点)</th>
                    <th>クリアタイム(秒)</th>
                </tr>
            </thead>
            <tbody id="table_body">
                <tr><td colspan="4" class="loading">データを取得中...</td></tr>
            </tbody>
        </table>
    </div>

    <script type="text/javascript">
        const spreadsheetIds = {
            'bronze': '1k2Gdgpl1BojoH9FB2x4_kvJfYPrqRDWAWpmKlLKf7_w',
            'silver': '1InuKN189VS-mClhAM1vsYU2NE5QFq8_Mut3mp1tQkkE',
            'gold': '1ZIZKXQGa4XCodWRUTc55DZ1o4xFUsQflaU-x5vo90bI',
            'platinum': '1AG7oRVh5_de9JcWl9Mcw7qWWtka8Dsc9fv43O7f54PM',
            'm2spike': '1CBarwg3feFZrW8HLY6D2sVzzEU2QoVmyas0qYJFByJU',
            'm2ev3': '1pubGzi3MIBKK6fLFD6kkgBsFAHRQPHqkHdq2SJDM35g',
            'm3': '1ZkjPfGBQ47ih1-eIhp-45ThnAbctC4ROvWFuPyIdZEc'
        };

        const range = 'B4:E28'; 
        let currentCourse = 'bronze';

        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(fetchData);

        function switchTab(courseKey, element) {
            currentCourse = courseKey;
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            
            document.getElementById('table_body').innerHTML = `<tr><td colspan="4" class="loading">読み込み中...</td></tr>`;
            fetchData();
        }

        function fetchData() {
            const id = spreadsheetIds[currentCourse];
            const query = new google.visualization.Query(
                `https://docs.google.com/spreadsheets/d/${id}/gviz/tq?range=${range}`
            );
            query.send(handleResponse);
        }

        function handleResponse(response) {
            if (response.isError()) {
                document.getElementById('table_body').innerHTML = `<tr><td colspan="4" class="loading">エラー: スプレッドシートの公開設定を確認してください</td></tr>`;
                return;
            }
            const data = response.getDataTable();
            const rowCount = data.getNumberOfRows();
            let html = "";

            for (let i = 0; i < rowCount; i++) {
                html += "<tr>";
                html += `<td>${data.getFormattedValue(i, 0)}</td>`;
                html += `<td>${data.getFormattedValue(i, 1)}</td>`;
                html += `<td>${data.getFormattedValue(i, 2)}</td>`;
                html += `<td>${data.getFormattedValue(i, 3)}</td>`;
                html += "</tr>";
            }
            document.getElementById('table_body').innerHTML = html;
        }

        // 30秒ごとに自動更新
        setInterval(fetchData, 30000);
    </script>
</body>
</html>